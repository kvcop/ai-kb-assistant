# Telegram
TG_BOT_TOKEN="123456:ABCDEF..."
TG_OWNER_CHAT_ID="123456789"       # owner chat id (usually your private chat; use /id)
TG_ALLOWED_USER_IDS="123456789"    # (optional) allow private chats by user_id (comma-separated)
TG_ALLOWED_CHAT_IDS="-100123..."   # (optional) allow group chats by chat_id (comma-separated)
TG_WORKSPACES_DIR="logs/tg-bot/workspaces"  # (optional) per-chat isolated KB roots for non-owner chats
TG_ACK_ENABLED=1
TG_ACK_INCLUDE_QUEUE=1
TG_TYPING_ENABLED=1
TG_TYPING_INTERVAL_SECONDS=4
TG_PROGRESS_EDIT_ENABLED=1
TG_PROGRESS_EDIT_INTERVAL_SECONDS=20
TG_TOPIC_LOG_MODE="semantic"        # semantic (default; меньше шума) | all (всё: ack/progress/ошибки/ретраи)
TG_CODEX_PARSE_MODE="HTML"          # HTML (best-effort Markdown→HTML) | Markdown | MarkdownV2 | 0
TG_CODEX_JSON_PROGRESS=0            # 1 = codex exec --json (show last events/commands in progress)
TG_CODEX_PROBE_HOST="chatgpt.com"   # network probe host for auto-resume after outages
TG_CODEX_PROBE_PORT=443
TG_CODEX_PROBE_TIMEOUT_SECONDS=3
# Telegram Bot API endpoint selection (Local Bot API server; optional)
TG_BOT_API_LOCAL_URL="http://127.0.0.1:8081"
TG_BOT_API_REMOTE_URL="https://api.telegram.org"
TG_BOT_API_PREFER_LOCAL=0
TG_BOT_API_PROBE_SECONDS=300
# Attachments (Telegram file uploads)
TG_UPLOADS_DIR="tg_uploads"         # where to save downloaded files (relative to repo root)
TG_UPLOAD_MAX_MB=50                 # max download size (0 = unlimited)

# Speech2Text (optional)
# Optional: set API base URL (defaults to http://127.0.0.1:8000/api)
# SPEECH2TEXT_BASE_URL="http://127.0.0.1:8000/api"
# Optional: provide token via env (otherwise read ~/.config/speech2text/token)
# SPEECH2TEXT_TOKEN="..."

# Watcher
WATCH_INTERVAL_SECONDS=180
WATCH_WORK_HOURS="09:30-19:00"
WATCH_INCLUDE_WEEKENDS=0

WATCH_IDLE_MINUTES=120
WATCH_ACK_MINUTES=20
# Absolute minutes since last touch, for staged escalation:
# WATCH_IDLE_STAGE_MINUTES="120,140,170,230,320"

# Router
ROUTER_MODE="hybrid"                # codex | heuristic | hybrid
ROUTER_MIN_PROFILE="read"           # read | write | danger (floor)
ROUTER_CONFIDENCE_THRESHOLD=0.6
ROUTER_DEBUG=0
TG_ROUTER_DEBUG=0                   # alias for ROUTER_DEBUG
ROUTER_FORCE_WRITE_PREFIX="!"
ROUTER_FORCE_READ_PREFIX="?"
# ⚠️ Dangerous override (bypasses router; runs Codex with --dangerously-bypass-approvals-and-sandbox --sandbox danger-full-access):
ROUTER_FORCE_DANGEROUS_PREFIX="∆"
# If 1: router can auto-enable dangerous (no confirmation) when it detects network/out-of-repo needs.
ROUTER_DANGEROUS_AUTO=0

# Codex
CODEX_BIN="codex"
CODEX_CHAT_SANDBOX="read-only"
CODEX_AUTO_FULL_AUTO=1
CODEX_ROUTER_SANDBOX="read-only"
# Optional: keep router history separate
# CODEX_HOME_ROUTER=".codex-tg/router"
# Optional: keep dangerous sessions separate
# CODEX_HOME_DANGER=".codex-tg/danger"

# Legacy fallback patterns (only for hybrid/heuristic)
# CODEX_AUTOMATION_PATTERNS="(закончим\s+день|end\s*of\s*day|обнови\s+статус)"

# Gentle mode ("щадящий режим")
GENTLE_DEFAULT_MINUTES=480
GENTLE_PING_COOLDOWN_MINUTES=90
GENTLE_AUTO_IDLE_MINUTES=240
GENTLE_AUTO_MUTE_WINDOW_MINUTES=180
GENTLE_AUTO_MUTE_COUNT=3
GENTLE_STAGE_CAP=4

# History / context injection
HISTORY_MAX_EVENTS=120
HISTORY_CONTEXT_LIMIT=30
HISTORY_ENTRY_MAX_CHARS=500

# Codex follow-up safety (for inline buttons under Codex answers)
CODEX_FOLLOWUP_SANDBOX="read-only"

# Mattermost (unread → Telegram topic bound by /reminders)
# Dependency: pip install mattermostdriver
MM_ENABLED=0
# Host or full URL (optionally with basepath), e.g.:
# MM_URL="mm.example.com"
# MM_URL="https://mm.example.com/mattermost"
MM_URL=""
MM_AUTH_MODE="auto"                 # auto | token | login
MM_TOKEN=""                         # Personal Access Token (если auth=token)
MM_LOGIN_ID=""                      # username/email/AD id (если auth=login)
MM_PASSWORD=""                      # password (если auth=login)
MM_SCHEME="https"
MM_PORT=443
MM_BASEPATH=""                      # e.g. "/mattermost" if applicable
MM_VERIFY=1
MM_TIMEOUT_SECONDS=20
MM_UNREAD_MINUTES=15                # forward if unread for >= N minutes
MM_POLL_INTERVAL_SECONDS=180
# Target selection (optional): by default scans all teams + channels available to the user.
MM_TEAM_NAMES=""                    # comma-separated team names from URL
MM_TEAM_IDS=""                      # comma-separated team IDs
MM_CHANNEL_IDS=""                   # comma-separated channel IDs (supports DMs); if set, team scan is skipped
MM_EXTRA_CHANNEL_IDS=""             # extra channel IDs to always include (does not disable team scan)
MM_INCLUDE_DMS=1                    # include direct/group messages when scanning (ignored if MM_CHANNEL_IDS is set)
MM_CACHE_SESSION_TOKEN=1            # cache session token to logs/tg-bot/state.json to reduce MFA prompts on restarts
MM_MAX_CHANNELS=100
MM_MAX_POSTS_PER_CHANNEL=20
MM_POST_MAX_CHARS=400
